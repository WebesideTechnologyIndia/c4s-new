{% extends 'admin/base.html' %}
{% block title %}Content Pages{% endblock %}
{% block page_title %}All Content Pages{% endblock %}

{% block extra_css %}
<style>
    .page-card {
        transition: all 0.3s ease;
        border-left: 4px solid #e9ecef;
    }
    
    .page-card:hover {
        box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        border-left-color: #0d6efd;
    }
    
    .page-card.featured {
        border-left-color: #ffc107;
        background-color: #fffef8;
    }
    
    .page-card.inactive {
        opacity: 0.6;
        background-color: #f8f9fa;
    }
    
    .page-image {
        width: 80px;
        height: 80px;
        object-fit: cover;
        border-radius: 8px;
    }
    
    .page-image-placeholder {
        width: 80px;
        height: 80px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        border-radius: 8px;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-size: 1.5rem;
    }
    
    .badge-status {
        font-size: 0.75rem;
        padding: 0.35rem 0.65rem;
    }
    
    .subcategory-badge {
        background-color: #e7f1ff;
        color: #0c63e4;
        font-size: 0.8rem;
        padding: 0.4rem 0.8rem;
        border-radius: 20px;
        font-weight: 500;
    }
    
    .action-btn {
        padding: 0.4rem 0.8rem;
        font-size: 0.875rem;
    }
    
    .search-box {
        max-width: 400px;
    }
    
    .stats-card {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border-radius: 10px;
        padding: 1.5rem;
        margin-bottom: 1.5rem;
    }
    
    .stats-item {
        text-align: center;
    }
    
    .stats-number {
        font-size: 2rem;
        font-weight: bold;
        display: block;
    }
    
    .stats-label {
        font-size: 0.875rem;
        opacity: 0.9;
    }
    
    .empty-state {
        text-align: center;
        padding: 4rem 2rem;
        color: #6c757d;
    }
    
    .empty-state i {
        font-size: 4rem;
        opacity: 0.3;
        margin-bottom: 1rem;
    }
</style>
{% endblock %}

{% block content %}

<!-- Stats Overview -->
<div class="stats-card">
    <div class="row">
        <div class="col-md-3 stats-item">
            <span class="stats-number">{{ total_pages }}</span>
            <span class="stats-label">Total Pages</span>
        </div>
        <div class="col-md-3 stats-item">
            <span class="stats-number">{{ active_pages }}</span>
            <span class="stats-label">Active Pages</span>
        </div>
        <div class="col-md-3 stats-item">
            <span class="stats-number">{{ featured_pages }}</span>
            <span class="stats-label">Featured Pages</span>
        </div>
        <div class="col-md-3 stats-item">
            <span class="stats-number">{{ inactive_pages }}</span>
            <span class="stats-label">Inactive Pages</span>
        </div>
    </div>
</div>

<!-- Header with Search and Add Button -->
<div class="card mb-4">
    <div class="card-body">
        <div class="row align-items-center">
            <div class="col-md-6">
                <div class="input-group search-box">
                    <span class="input-group-text bg-white">
                        <i class="bi bi-search"></i>
                    </span>
                    <input type="text" class="form-control" id="searchInput" 
                           placeholder="Search pages by title...">
                </div>
            </div>
            <div class="col-md-6 text-end">
                <div class="btn-group" role="group">
                    <button type="button" class="btn btn-outline-secondary" id="filterAll">
                        All ({{ total_pages }})
                    </button>
                    <button type="button" class="btn btn-outline-success" id="filterActive">
                        Active ({{ active_pages }})
                    </button>
                    <button type="button" class="btn btn-outline-warning" id="filterFeatured">
                        Featured ({{ featured_pages }})
                    </button>
                    <button type="button" class="btn btn-outline-secondary" id="filterInactive">
                        Inactive ({{ inactive_pages }})
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Content Pages List -->
<div class="row" id="pagesList">
    {% if pages %}
        {% for page in pages %}
        <div class="col-12 mb-3 page-item" 
             data-status="{{ page.is_active|lower }}"
             data-featured="{{ page.is_featured|lower }}"
             data-title="{{ page.title|lower }}">
            <div class="card page-card {% if page.is_featured %}featured{% endif %} {% if not page.is_active %}inactive{% endif %}">
                <div class="card-body">
                    <div class="row align-items-center">
                        <!-- Image -->
                        <div class="col-auto">
                            {% if page.featured_image %}
                                <img src="{{ page.featured_image.url }}" 
                                     alt="{{ page.title }}" 
                                     class="page-image">
                            {% elif page.featured_image_url %}
                                <img src="{{ page.featured_image_url }}" 
                                     alt="{{ page.title }}" 
                                     class="page-image">
                            {% else %}
                                <div class="page-image-placeholder">
                                    <i class="bi bi-file-text"></i>
                                </div>
                            {% endif %}
                        </div>
                        
                        <!-- Content Details -->
                        <div class="col">
                            <div class="d-flex align-items-start justify-content-between">
                                <div>
                                    <h5 class="mb-1">
                                        {{ page.title }}
                                        {% if page.is_featured %}
                                            <i class="bi bi-star-fill text-warning ms-2" 
                                               title="Featured"></i>
                                        {% endif %}
                                    </h5>
                                    
                                    <div class="mb-2">
                                        <span class="subcategory-badge">
                                            <i class="bi bi-folder me-1"></i>
                                            {{ page.sub_category.parent_card.title }} â†’ {{ page.sub_category.title }}
                                        </span>
                                    </div>
                                    
                                    {% if page.summary %}
                                        <p class="text-muted mb-2 small">{{ page.summary|truncatewords:20 }}</p>
                                    {% endif %}
                                    
                                    <div class="small text-muted">
                                        <i class="bi bi-link-45deg"></i>
                                        <code>/{{ page.slug }}</code>
                                        <span class="ms-3">
                                            <i class="bi bi-sort-numeric-down"></i>
                                            Order: {{ page.order }}
                                        </span>
                                        <span class="ms-3">
                                            <i class="bi bi-calendar-event"></i>
                                            {{ page.created_at|date:"d M, Y" }}
                                        </span>
                                        {% if page.created_by %}
                                            <span class="ms-3">
                                                <i class="bi bi-person"></i>
                                                {{ page.created_by.get_full_name|default:page.created_by.username }}
                                            </span>
                                        {% endif %}
                                    </div>
                                </div>
                                
                                <!-- Status and Actions -->
                                <div class="text-end">
                                    <div class="mb-2">
                                        {% if page.is_active %}
                                            <span class="badge bg-success badge-status">
                                                <i class="bi bi-check-circle"></i> Active
                                            </span>
                                        {% else %}
                                            <span class="badge bg-secondary badge-status">
                                                <i class="bi bi-x-circle"></i> Inactive
                                            </span>
                                        {% endif %}
                                    </div>
                                    
                                    <div class="btn-group" role="group">
                                        <a href="{% url 'main_app:admin_content_page_edit' page.pk %}" 
                                           class="btn btn-sm btn-outline-primary action-btn"
                                           title="Edit">
                                            <i class="bi bi-pencil"></i>
                                        </a>
                                        <a href="{% url 'main_app:admin_content_page_delete' page.pk %}" 
                                           class="btn btn-sm btn-outline-danger action-btn"
                                           onclick="return confirm('Are you sure you want to delete this page?')"
                                           title="Delete">
                                            <i class="bi bi-trash"></i>
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        {% endfor %}
    {% else %}
        <div class="col-12">
            <div class="empty-state">
                <i class="bi bi-file-earmark-x"></i>
                <h4>No Content Pages Yet</h4>
                <p class="text-muted">Start by creating your first content page.</p>
            </div>
        </div>
    {% endif %}
</div>

<!-- Empty State for No Results -->
<div class="col-12 d-none" id="noResults">
    <div class="empty-state">
        <i class="bi bi-search"></i>
        <h5>No pages found</h5>
        <p class="text-muted">Try adjusting your search or filter criteria.</p>
    </div>
</div>

{% endblock %}

{% block extra_js %}
<script>
    // Search functionality
    const searchInput = document.getElementById('searchInput');
    const pageItems = document.querySelectorAll('.page-item');
    const noResults = document.getElementById('noResults');
    
    searchInput.addEventListener('input', function() {
        const searchTerm = this.value.toLowerCase();
        let visibleCount = 0;
        
        pageItems.forEach(item => {
            const title = item.dataset.title;
            const isVisible = !item.classList.contains('d-none');
            
            if (title.includes(searchTerm)) {
                if (isVisible) {
                    item.classList.remove('d-none');
                    visibleCount++;
                }
            } else {
                item.classList.add('d-none');
            }
        });
        
        // Show/hide no results message
        if (visibleCount === 0) {
            noResults.classList.remove('d-none');
        } else {
            noResults.classList.add('d-none');
        }
    });
    
    // Filter functionality
    const filterButtons = {
        all: document.getElementById('filterAll'),
        active: document.getElementById('filterActive'),
        featured: document.getElementById('filterFeatured'),
        inactive: document.getElementById('filterInactive')
    };
    
    function setActiveFilter(button) {
        Object.values(filterButtons).forEach(btn => {
            btn.classList.remove('active');
            btn.classList.add('btn-outline-secondary');
            btn.classList.remove('btn-success', 'btn-warning');
        });
        button.classList.add('active');
    }
    
    filterButtons.all.addEventListener('click', function() {
        setActiveFilter(this);
        pageItems.forEach(item => item.classList.remove('d-none'));
        searchInput.value = '';
        noResults.classList.add('d-none');
    });
    
    filterButtons.active.addEventListener('click', function() {
        setActiveFilter(this);
        this.classList.remove('btn-outline-secondary');
        this.classList.add('btn-success');
        
        let visibleCount = 0;
        pageItems.forEach(item => {
            if (item.dataset.status === 'true') {
                item.classList.remove('d-none');
                visibleCount++;
            } else {
                item.classList.add('d-none');
            }
        });
        
        searchInput.value = '';
        noResults.classList.toggle('d-none', visibleCount > 0);
    });
    
    filterButtons.featured.addEventListener('click', function() {
        setActiveFilter(this);
        this.classList.remove('btn-outline-secondary');
        this.classList.add('btn-warning');
        
        let visibleCount = 0;
        pageItems.forEach(item => {
            if (item.dataset.featured === 'true') {
                item.classList.remove('d-none');
                visibleCount++;
            } else {
                item.classList.add('d-none');
            }
        });
        
        searchInput.value = '';
        noResults.classList.toggle('d-none', visibleCount > 0);
    });
    
    filterButtons.inactive.addEventListener('click', function() {
        setActiveFilter(this);
        
        let visibleCount = 0;
        pageItems.forEach(item => {
            if (item.dataset.status === 'false') {
                item.classList.remove('d-none');
                visibleCount++;
            } else {
                item.classList.add('d-none');
            }
        });
        
        searchInput.value = '';
        noResults.classList.toggle('d-none', visibleCount > 0);
    });
    
    // Set initial active filter
    filterButtons.all.classList.add('active');
</script>
{% endblock %}